{% extends 'travel/base.html' %}
{% load static %}

{% block title %}–ö–æ—Ä–∑–∏–Ω–∞ - TravelLux{% endblock %}

{% block content %}
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
    <section class="hero" style="padding: 120px 0 60px;">
        <div class="container">
            <div class="hero-content">
                <h1>–ö–æ—Ä–∑–∏–Ω–∞</h1>
                <p>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Ç—É—Ä—ã –∏ –æ—Ñ–æ—Ä–º–∏—Ç–µ –∑–∞–∫–∞–∑</p>
            </div>
        </div>
    </section>

    <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–æ—Ä–∑–∏–Ω—ã -->
    <section class="section">
        <div class="container">
            {% if cart_items %}
                <div class="grid" style="grid-template-columns: 1fr 400px; gap: 2rem; align-items: start;">
                    <div>
                        <h2 class="mb-4">–í—ã–±—Ä–∞–Ω–Ω—ã–µ —Ç—É—Ä—ã</h2>
                        <div class="card">
                            <div class="card-content">
                                {% for item in cart_items %}
                                <div class="cart-item-row" style="display: flex; align-items: center; gap: 1rem; padding: 1.5rem 0; {% if not forloop.last %}border-bottom: 1px solid #e9ecef;{% endif %}">
                                    <div style="flex-shrink: 0;">
                                        {% if item.tour.image %}
                                            <img src="{{ item.tour.image.url }}" alt="{{ item.tour.title }}" style="width: 80px; height: 80px; object-fit: cover; border-radius: 8px;">
                                        {% else %}
                                            <div style="width: 80px; height: 80px; background: var(--gradient); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                                <i class="fas fa-mountain" style="color: white; font-size: 24px;"></i>
                                            </div>
                                        {% endif %}
                                    </div>
                                    <div style="flex: 1;">
                                        <h4 style="margin-bottom: 0.5rem;">{{ item.tour.title }}</h4>
                                        <div style="color: #666; font-size: 14px;">
                                            <div style="margin-bottom: 0.25rem;">
                                                <i class="fas fa-map-marker-alt"></i> {{ item.tour.destination }}
                                            </div>
                                            <div style="margin-bottom: 0.25rem;">
                                                <i class="fas fa-calendar"></i> –î–∞—Ç–∞: {{ item.start_date }}
                                            </div>
                                            <div>
                                                <i class="fas fa-users"></i> –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: {{ item.people_count }} —á–µ–ª.
                                            </div>
                                        </div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="font-size: 14px; color: #666; margin-bottom: 0.25rem;">{{ item.tour.price }} ‚ÇΩ √ó {{ item.people_count }}</div>
                                        <div style="font-size: 18px; font-weight: bold; color: var(--primary-color);">{{ item.total_price }} ‚ÇΩ</div>
                                    </div>
                                    <div style="flex-shrink: 0;">
                                        <a href="{% url 'remove_from_cart' item.pk %}" class="btn" style="background: var(--secondary-color); color: white; padding: 8px 12px; border-radius: 6px;" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å —Ç—É—Ä –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã?')">
                                            <i class="fas fa-trash"></i>
                                        </a>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        <div class="text-center" style="margin-top: 1.5rem;">
                            <a href="{% url 'clear_cart' %}" class="btn btn-secondary" onclick="return confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—é –∫–æ—Ä–∑–∏–Ω—É?')">–û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É</a>
                        </div>
                    </div>
                    
                    <div>
                        <div class="card">
                            <div class="card-content">
                                <h3 class="mb-4">–ò—Ç–æ–≥–æ</h3>
                                <div style="border-bottom: 1px solid #e9ecef; padding-bottom: 1rem; margin-bottom: 1rem;">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                        <span>–¢—É—Ä—ã ({{ cart_items|length }} —à—Ç.)</span>
                                        <span>{{ total }} ‚ÇΩ</span>
                                    </div>
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                        <span>–°–∫–∏–¥–∫–∞</span>
                                        <span style="color: var(--secondary-color);">-{{ discount }} ‚ÇΩ</span>
                                    </div>
                                </div>
                                <div style="display: flex; justify-content: space-between; font-size: 1.25rem; font-weight: bold; margin-bottom: 1.5rem;">
                                    <span>–ö –æ–ø–ª–∞—Ç–µ:</span>
                                    <span style="color: var(--primary-color);">{{ final_total }} ‚ÇΩ</span>
                                </div>
                                <button class="btn btn-primary" style="width: 100%; margin-bottom: 1rem;" onclick="proceedToCheckout()">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
                                <a href="{% url 'catalog' %}" class="btn btn-secondary" style="width: 100%; display: block; text-align: center;">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø–æ–∫—É–ø–∫–∏</a>
                            </div>
                        </div>
                        
                        <div class="card" style="margin-top: 1.5rem;">
                            <div class="card-content">
                                <h4 class="mb-2">üéÅ –ü—Ä–æ–º–æ–∫–æ–¥</h4>
                                <div style="display: flex; gap: 10px;">
                                    <input type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥" class="form-control" id="promo-input">
                                    <button class="btn btn-secondary" onclick="applyPromo()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            {% else %}
                <div class="text-center">
                    <div style="font-size: 4rem; margin-bottom: 2rem;">üõí</div>
                    <h2 class="mb-4">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</h2>
                    <p class="text-light mb-4">–î–æ–±–∞–≤—å—Ç–µ —Ç—É—Ä—ã –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ</p>
                    <a href="{% url 'catalog' %}" class="btn btn-primary">–í—ã–±—Ä–∞—Ç—å —Ç—É—Ä—ã</a>
                </div>
            {% endif %}
        </div>
    </section>

    <script>
        function applyPromo() {
            const promoInput = document.getElementById('promo-input');
            const promoCode = promoInput.value.trim().toUpperCase();
            
            const validCodes = {
                'WELCOME10': 10,
                'SUMMER20': 20,
                'TRAVEL15': 15,
                'FIRSTTRIP': 25
            };
            
            if (validCodes[promoCode]) {
                const notification = document.createElement('div');
                notification.innerHTML = `
                    <div style="position: fixed; top: 100px; right: 20px; background: var(--primary-color); color: white; padding: 15px 20px; border-radius: 8px; z-index: 10000; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
                        ‚úÖ –ü—Ä–æ–º–æ–∫–æ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω! –°–∫–∏–¥–∫–∞ ${validCodes[promoCode]}%
                    </div>
                `;
                document.body.appendChild(notification);
                promoInput.value = '';
                
                setTimeout(() => {
                    notification.remove();
                }, 3000);
            } else if (promoCode) {
                const notification = document.createElement('div');
                notification.innerHTML = `
                    <div style="position: fixed; top: 100px; right: 20px; background: var(--secondary-color); color: white; padding: 15px 20px; border-radius: 8px; z-index: 10000; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
                        ‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥
                    </div>
                `;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.remove();
                }, 3000);
            }
        }

        function proceedToCheckout() {
            // –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞
            const modal = document.createElement('div');
            modal.innerHTML = `
                <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; align-items: center; justify-content: center; padding: 20px;">
                    <div class="card" style="max-width: 500px; width: 100%; max-height: 90vh; overflow-y: auto;">
                        <div class="card-content">
                            <h3 class="mb-4">–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h3>
                            <form onsubmit="submitOrder(event)">
                                <div class="form-group">
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">–ò–º—è</label>
                                    <input type="text" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">–§–∞–º–∏–ª–∏—è</label>
                                    <input type="text" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Email</label>
                                    <input type="email" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                                    <input type="tel" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">–î–∞—Ç–∞ –≤—ã–ª–µ—Ç–∞</label>
                                    <input type="date" class="form-control" required>
                                </div>
                                <div class="form-group" style="margin-bottom: 2rem;">
                                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</label>
                                    <textarea class="form-control" rows="3" placeholder="–û—Å–æ–±—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è..."></textarea>
                                </div>
                                <div style="display: flex; gap: 1rem;">
                                    <button type="submit" class="btn btn-primary" style="flex: 1;">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–∫–∞–∑</button>
                                    <button type="button" class="btn btn-secondary" onclick="closeModal()" style="flex: 1;">–û—Ç–º–µ–Ω–∞</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            modal.querySelector('input').focus();
            
            window.closeModal = function() {
                modal.remove();
            };
            
            window.submitOrder = function(e) {
                e.preventDefault();
                const notification = document.createElement('div');
                notification.innerHTML = `
                    <div style="position: fixed; top: 100px; right: 20px; background: var(--primary-color); color: white; padding: 15px 20px; border-radius: 8px; z-index: 10000; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
                        üéâ –ó–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω! –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.
                    </div>
                `;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.remove();
                    window.location.href = "{% url 'home' %}";
                }, 3000);
                
                modal.remove();
            };
        }

        // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        document.addEventListener('DOMContentLoaded', function() {
            const cartItems = document.querySelectorAll('.cart-item-row');
            cartItems.forEach((item, index) => {
                item.style.opacity = '0';
                item.style.transform = 'translateY(20px)';
                item.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
                
                setTimeout(() => {
                    item.style.opacity = '1';
                    item.style.transform = 'translateY(0)';
                }, index * 100);
            });
        });
    </script>

    <style>
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr !important;
            }
            
            .cart-item-row {
                flex-direction: column !important;
                align-items: flex-start !important;
                gap: 1rem !important;
                text-align: left !important;
            }
            
            .cart-item-row > div {
                width: 100% !important;
                text-align: left !important;
            }
            
            .cart-item-row > div:last-child {
                text-align: center !important;
            }
        }
    </style>
{% endblock %}