{% extends 'travel/base.html' %}
{% load static %}

{% block title %}–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç - TravelLux{% endblock %}

{% block content %}
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
    <section class="hero" style="padding: 120px 0 60px;">
        <div class="container">
            <div class="hero-content">
                <h1>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h1>
                <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ user.first_name|default:user.username }}! –£–ø—Ä–∞–≤–ª—è–π—Ç–µ —Å–≤–æ–∏–º–∏ –ø–æ–µ–∑–¥–∫–∞–º–∏</p>
            </div>
        </div>
    </section>

    <!-- –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <section class="section">
        <div class="container">
            <div class="grid grid-3">
                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ—Ñ–∏–ª–µ -->
                <div class="card">
                    <div class="card-content text-center">
                        {% if profile.avatar %}
                            <img src="{{ profile.avatar.url }}" alt="Avatar" style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; margin-bottom: 1rem;">
                        {% else %}
                            <div style="width: 100px; height: 100px; background: var(--gradient); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem;">
                                <i class="fas fa-user" style="font-size: 40px; color: white;"></i>
                            </div>
                        {% endif %}
                        <h3 class="mb-2">{{ user.first_name|default:user.username }}</h3>
                        <p class="text-light mb-3">{{ user.email|default:"Email –Ω–µ —É–∫–∞–∑–∞–Ω" }}</p>
                        <div class="text-left">
                            <p class="mb-2"><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> {{ profile.phone|default:"–ù–µ —É–∫–∞–∑–∞–Ω" }}</p>
                            {% if profile.birth_date %}
                                <p class="mb-2"><strong>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è:</strong> {{ profile.birth_date }}</p>
                            {% endif %}
                            <p class="mb-2"><strong>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è:</strong> {{ user.date_joined|date:"d.m.Y" }}</p>
                        </div>
                        <a href="{% url 'edit_profile' %}" class="btn btn-secondary">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</a>
                    </div>
                </div>

                <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
                <div class="card">
                    <div class="card-content">
                        <h3 class="mb-4 text-center">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                        <div class="grid grid-2" style="gap: 1rem;">
                            <div class="text-center" style="padding: 1rem; background: var(--background-light); border-radius: 8px;">
                                <div style="font-size: 2rem; font-weight: bold; color: var(--primary-color);">{{ bookings.count }}</div>
                                <div style="font-size: 12px; color: #666;">–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤</div>
                            </div>
                            <div class="text-center" style="padding: 1rem; background: var(--background-light); border-radius: 8px;">
                                <div style="font-size: 2rem; font-weight: bold; color: var(--secondary-color);">{{ user.cart_set.count }}</div>
                                <div style="font-size: 12px; color: #666;">–í –∫–æ—Ä–∑–∏–Ω–µ</div>
                            </div>
                            <div class="text-center" style="padding: 1rem; background: var(--background-light); border-radius: 8px;">
                                <div style="font-size: 2rem; font-weight: bold; color: var(--accent-color);">{{ bookings|length }}</div>
                                <div style="font-size: 12px; color: #666;">–ê–∫—Ç–∏–≤–Ω—ã—Ö</div>
                            </div>
                            <div class="text-center" style="padding: 1rem; background: var(--background-light); border-radius: 8px;">
                                <div style="font-size: 2rem; font-weight: bold; color: var(--primary-color);">üèÜ</div>
                                <div style="font-size: 12px; color: #666;">VIP —Å—Ç–∞—Ç—É—Å</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
                <div class="card">
                    <div class="card-content">
                        <h3 class="mb-4 text-center">–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
                        <div style="display: flex; flex-direction: column; gap: 1rem;">
                            <a href="{% url 'catalog' %}" class="btn btn-primary">
                                <i class="fas fa-search"></i> –ù–∞–π—Ç–∏ —Ç—É—Ä—ã
                            </a>
                            <a href="{% url 'cart' %}" class="btn btn-secondary">
                                <i class="fas fa-shopping-cart"></i> –ö–æ—Ä–∑–∏–Ω–∞ ({{ user.cart_set.count }})
                            </a>
                            <button class="btn" style="background: var(--accent-color); color: white;" onclick="showSupport()">
                                <i class="fas fa-headset"></i> –ü–æ–¥–¥–µ—Ä–∂–∫–∞
                            </button>
                            <a href="{% url 'logout' %}" class="btn" style="background: #dc3545; color: white;" onclick="return confirm('–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã?')">
                                <i class="fas fa-sign-out-alt"></i> –í—ã–π—Ç–∏
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- –ú–æ–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è -->
    <section class="section bg-white">
        <div class="container">
            <div class="section-header">
                <h2>–ú–æ–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
                <p>–ò—Å—Ç–æ—Ä–∏—è –≤–∞—à–∏—Ö –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–π —Å TravelLux</p>
            </div>
            
            {% if bookings %}
                <div class="grid grid-2">
                    {% for booking in bookings %}
                    <div class="card">
                        <div class="card-content">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                <h4>{{ booking.tour.title }}</h4>
                                <span style="padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 600; 
                                    {% if booking.status == 'confirmed' %}background: #d4edda; color: #155724;
                                    {% elif booking.status == 'pending' %}background: #fff3cd; color: #856404;
                                    {% else %}background: #f8d7da; color: #721c24;{% endif %}">
                                    {{ booking.get_status_display }}
                                </span>
                            </div>
                            <div style="color: #666; margin-bottom: 1rem;">
                                <p style="margin-bottom: 0.5rem;"><i class="fas fa-map-marker-alt"></i> {{ booking.tour.destination }}</p>
                                <p style="margin-bottom: 0.5rem;"><i class="fas fa-calendar"></i> {{ booking.start_date }}</p>
                                <p style="margin-bottom: 0.5rem;"><i class="fas fa-users"></i> {{ booking.people_count }} —á–µ–ª–æ–≤–µ–∫</p>
                                <p style="margin-bottom: 0.5rem;"><i class="fas fa-ruble-sign"></i> {{ booking.total_price }} ‚ÇΩ</p>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding-top: 1rem; border-top: 1px solid #e9ecef;">
                                <small style="color: #666;">–ó–∞–∫–∞–∑ –æ—Ç {{ booking.created_at|date:"d.m.Y" }}</small>
                                {% if booking.status == 'pending' %}
                                    <button class="btn" style="background: #dc3545; color: white; padding: 4px 8px; font-size: 12px;" onclick="cancelBooking({{ booking.id }})">
                                        –û—Ç–º–µ–Ω–∏—Ç—å
                                    </button>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="text-center">
                    <div style="font-size: 4rem; margin-bottom: 2rem;">üß≥</div>
                    <h3 class="mb-3">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π</h3>
                    <p class="text-light mb-4">–í—ã–±–µ—Ä–∏—Ç–µ —Ç—É—Ä –∏ –Ω–∞—á–Ω–∏—Ç–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ</p>
                    <a href="{% url 'catalog' %}" class="btn btn-primary">–í—ã–±—Ä–∞—Ç—å —Ç—É—Ä</a>
                </div>
            {% endif %}
        </div>
    </section>

    <!-- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ -->
    <section class="section">
        <div class="container">
            <div class="section-header">
                <h2>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –≤–∞—Å</h2>
                <p>–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –≤–∞—Å –∑–∞–∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞—Ç—å</p>
            </div>
            <div class="grid grid-3">
                <div class="card">
                    <img src="https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400&h=200&fit=crop" alt="–ï–≤—Ä–æ–ø–∞" class="card-img">
                    <div class="card-content">
                        <h3>–ï–≤—Ä–æ–ø–µ–π—Å–∫–∏–µ —Å—Ç–æ–ª–∏—Ü—ã</h3>
                        <p class="card-text">–û—Ç–∫—Ä–æ–π—Ç–µ –¥–ª—è —Å–µ–±—è –±–æ–≥–∞—Ç—Å—Ç–≤–æ –∏—Å—Ç–æ—Ä–∏–∏ –∏ –∫—É–ª—å—Ç—É—Ä—ã</p>
                        <div class="card-price">–æ—Ç 89 900 ‚ÇΩ</div>
                        <a href="{% url 'catalog' %}?destination=europe" class="btn btn-primary">–°–º–æ—Ç—Ä–µ—Ç—å —Ç—É—Ä—ã</a>
                    </div>
                </div>
                <div class="card">
                    <img src="https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400&h=200&fit=crop" alt="–ê–∑–∏—è" class="card-img">
                    <div class="card-content">
                        <h3>–≠–∫–∑–æ—Ç–∏—á–µ—Å–∫–∞—è –ê–∑–∏—è</h3>
                        <p class="card-text">–ü–æ–≥—Ä—É–∑–∏—Ç–µ—Å—å –≤ –º–∏—Ä –¥—Ä–µ–≤–Ω–∏—Ö —Ç—Ä–∞–¥–∏—Ü–∏–π</p>
                        <div class="card-price">–æ—Ç 69 900 ‚ÇΩ</div>
                        <a href="{% url 'catalog' %}?destination=asia" class="btn btn-primary">–°–º–æ—Ç—Ä–µ—Ç—å —Ç—É—Ä—ã</a>
                    </div>
                </div>
                <div class="card">
                    <img src="https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400&h=200&fit=crop" alt="–ü–ª—è–∂" class="card-img">
                    <div class="card-content">
                        <h3>–ü–ª—è–∂–Ω—ã–π –æ—Ç–¥—ã—Ö</h3>
                        <p class="card-text">–†–∞—Å—Å–ª–∞–±—å—Ç–µ—Å—å –Ω–∞ –ª—É—á—à–∏—Ö –∫—É—Ä–æ—Ä—Ç–∞—Ö –º–∏—Ä–∞</p>
                        <div class="card-price">–æ—Ç 99 900 ‚ÇΩ</div>
                        <a href="{% url 'catalog' %}?type=beach" class="btn btn-primary">–°–º–æ—Ç—Ä–µ—Ç—å —Ç—É—Ä—ã</a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script>
        function editProfile() {
            const modal = document.createElement('div');
            modal.innerHTML = `
                <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; align-items: center; justify-content: center; padding: 20px;">
                    <div class="card" style="max-width: 400px; width: 100%;">
                        <div class="card-content">
                            <h3 class="mb-3">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</h3>
                            <form>
                                <div class="form-group">
                                    <label>–ò–º—è</label>
                                    <input type="text" class="form-control" value="{{ user.first_name|default:'' }}">
                                </div>
                                <div class="form-group">
                                    <label>–§–∞–º–∏–ª–∏—è</label>
                                    <input type="text" class="form-control" value="{{ user.last_name|default:'' }}">
                                </div>
                                <div class="form-group">
                                    <label>Email</label>
                                    <input type="email" class="form-control" value="{{ user.email|default:'' }}">
                                </div>
                                <div class="form-group">
                                    <label>–¢–µ–ª–µ—Ñ–æ–Ω</label>
                                    <input type="tel" class="form-control" value="{{ profile.phone|default:'' }}">
                                </div>
                                <div style="display: flex; gap: 1rem;">
                                    <button type="submit" class="btn btn-primary" style="flex: 1;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                                    <button type="button" class="btn btn-secondary" onclick="closeModal()" style="flex: 1;">–û—Ç–º–µ–Ω–∞</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            window.closeModal = function() {
                modal.remove();
            };
        }

        function showSupport() {
            const modal = document.createElement('div');
            modal.innerHTML = `
                <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 10000; display: flex; align-items: center; justify-content: center; padding: 20px;">
                    <div class="card" style="max-width: 400px; width: 100%;">
                        <div class="card-content text-center">
                            <h3 class="mb-3">–°–ª—É–∂–±–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏</h3>
                            <div style="font-size: 3rem; margin-bottom: 1rem;">üìû</div>
                            <p class="mb-3">–ú—ã –≤—Å–µ–≥–¥–∞ –≥–æ—Ç–æ–≤—ã –ø–æ–º–æ—á—å –≤–∞–º!</p>
                            <div style="text-align: left; margin-bottom: 2rem;">
                                <p><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> +7 (495) 123-45-67</p>
                                <p><strong>Email:</strong> support@travellux.ru</p>
                                <p><strong>–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã:</strong> 24/7</p>
                            </div>
                            <button class="btn btn-primary" onclick="closeModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            window.closeModal = function() {
                modal.remove();
            };
        }

        function cancelBooking(bookingId) {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ?')) {
                // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å AJAX –∑–∞–ø—Ä–æ—Å –¥–ª—è –æ—Ç–º–µ–Ω—ã –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
                alert('–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ');
            }
        }

        // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        document.addEventListener('DOMContentLoaded', function() {
            const cards = document.querySelectorAll('.card');
            cards.forEach((card, index) => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                card.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
                
                setTimeout(() => {
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                }, index * 100);
            });
        });
    </script>
{% endblock %}